// android/app/build.gradle
plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android'
    id 'dev.flutter.flutter-gradle-plugin'
    // NOTE: do NOT apply 'com.google.gms.google-services' here (we removed Firebase for CI)
}

android {
    namespace "com.example.visora_ai_flutter"
    compileSdk 34

    defaultConfig {
        applicationId "com.example.visora_ai_flutter"
        minSdk 23
        targetSdk 34
        versionCode 1
        versionName "1.0"

        multiDexEnabled true
    }

    // --- SIGNING CONFIGS ---
    signingConfigs {
        release {
            // If your CI writes the keystore to android/app/visora-release.jks (recommended),
            // keep the line below:
            storeFile file("visora-release.jks")

            // If your CI decodes keystore to $HOME/visora-release.jks (runner home),
            // comment the above line and uncomment the line below:
            // storeFile file(System.getenv("HOME") + "/visora-release.jks")

            // Read passwords and alias from environment variables (set as GitHub secrets)
            storePassword System.getenv("ANDROID_KEYSTORE_PASSWORD") ?: ""
            keyAlias System.getenv("ANDROID_KEY_ALIAS") ?: ""
            keyPassword System.getenv("ANDROID_KEY_PASSWORD") ?: ""
        }
    }

    buildTypes {
        release {
            // Sign with our release signingConfig
            signingConfig signingConfigs.release

            // Keep disabled for easier debugging in CI
            minifyEnabled false
            shrinkResources false

            // Uncomment if you have proguard rules
            // proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }

        debug {
            minifyEnabled false
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = '17'
    }

    packagingOptions {
        resources {
            excludes += ['META-INF/DEPENDENCIES', 'META-INF/NOTICE', 'META-INF/NOTICE.txt', 'META-INF/LICENSE', 'META-INF/LICENSE.txt']
        }
    }
}

flutter {
    source '../..'
}

dependencies {
    implementation 'androidx.core:core-ktx:1.13.1'
    implementation 'androidx.multidex:multidex:2.0.1'

    // Add other Android native deps here if needed
    // Firebase lines removed (we are building without google-services)
}
